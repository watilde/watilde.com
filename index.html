<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><link rel="icon" type="image/png" href="/images/cabin.png"><link href="/styles/main.css" rel="stylesheet"><title>watilde.blog</title></head><body><nav><h1 class="name"><a href="/">Blog</a></h1><div class="menu icon-menu"></div><ul class="nav-links"><li class="text-link"><a href="/about.html">about</a></li><li class="text-link"><a href="/projects.html">projects</a></li><li class="text-link"><a href="/archives.html">archives</a></li></ul><div class="social-media"><a href="https://github.com/watilde" class="icon-github"></a><a href="https://twitter.com/watilde" class="icon-twitter"></a></div></nav><div class="content"><div class="post-head group"><a href="/posts/make-gruntfile-js-10-rows/"><h1 class="post-title">Make Gruntfile.js 10 rows</h1></a><span class="post-date">2014 &#183; 2 &#183; 15</span></div><div class="post-body markdown"><h2><a name="background" class="anchor" href="#background"><span class="header-link"></span></a>Background</h2>
<p>Everyone loves Grunt.js that is highly functional JavaScript task runner and we expect too much on Gruntfile.js as is often the case like the following:</p>
<ul>
<li>Concatenate files</li>
<li>Minify files with UglifyJS</li>
<li>Validate files with JSHint</li>
<li>Compile CoffeeScript files to JavaScript</li>
<li>Run Nodeunit unit tests</li>
<li>Compile underscore templates to JST file.</li>
<li>Start a static web server.</li>
<li>etc...</li>
</ul>
<p>If all of these tasks are putted to Gruntfile.js then the file line of row become more than 300 line. Furthermore, it was added some tasks on a per-service basis with some append the path to the directory then the number of rows will increase tripled twice.
Using <code>require</code> for avoid this problem just because we are using node.js.</p>
<h2><a name="example-code" class="anchor" href="#example-code"><span class="header-link"></span></a>Example code</h2>
<h3><a name="gruntfile-js" class="anchor" href="#gruntfile-js"><span class="header-link"></span></a>Gruntfile.js</h3>
<p>Gruntfile.js is only for:</p>
<ul>
<li>Get and Set object for initConfig</li>
<li>Load NpmTask</li>
<li>Register gruntTask</li>
</ul>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="c1">// Gruntfile.js</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">configObject</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./grunt/config&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">PACKAGE_JSON</span> <span class="o">=</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">readJSON</span><span class="p">(</span><span class="s2">&quot;package.json&quot;</span><span class="p">);</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">configObject</span><span class="p">);</span>
  <span class="c1">// Load Grunt Plugins</span>
  <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">PACKAGE_JSON</span><span class="p">.</span><span class="nx">devDependencies</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">);</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;connect&#39;</span><span class="p">,</span> <span class="s1">&#39;watch&#39;</span><span class="p">]);</span>
  <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;release&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;less&#39;</span><span class="p">,</span> <span class="s1">&#39;jst&#39;</span><span class="p">,</span> <span class="s1">&#39;concat&#39;</span><span class="p">,</span> <span class="s1">&#39;jshint&#39;</span><span class="p">,</span> <span class="s1">&#39;uglify&#39;</span><span class="p">]);</span>
<span class="p">};</span>
</pre></div>
</code></pre>
<h3><a name="config-js" class="anchor" href="#config-js"><span class="header-link"></span></a>config.js</h3>
<ul>
<li>Interface of initConfig</li>
</ul>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="c1">// grunt/config.js</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">connect</span><span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./connect&#39;</span><span class="p">),</span>
  <span class="nx">htmlmin</span><span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./htmlmin&#39;</span><span class="p">),</span>
  <span class="nx">jst</span><span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./jst&#39;</span><span class="p">),</span>
  <span class="nx">jshint</span><span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./jshint&#39;</span><span class="p">),</span>
  <span class="nx">concat</span><span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./concat&#39;</span><span class="p">),</span>
  <span class="nx">uglify</span><span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./uglify&#39;</span><span class="p">),</span>
  <span class="nx">watch</span><span class="o">:</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./watch&#39;</span><span class="p">)</span>
<span class="p">};</span>
</pre></div>
</code></pre>
<h3><a name="other-configs" class="anchor" href="#other-configs"><span class="header-link"></span></a>Other config(s)</h3>
<ul>
<li>1 File per 1 Module</li>
</ul>
<pre><code class="lang-javascript"><div class="highlight"><pre><span class="c1">// grunt/connect.js</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">server</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">port</span><span class="o">:</span> <span class="mi">3000</span><span class="p">,</span>
      <span class="nx">base</span><span class="o">:</span> <span class="s1">&#39;www/&#39;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</code></pre>
<h2><a name="impre" class="anchor" href="#impre"><span class="header-link"></span></a>Impre</h2>
<p>TG there&#39;s <code>module.exports</code> &lt;3</p>
<p>A project using that: <a href="https://github.com/watilde/dartstack">dartstack</a></p>
</div><div class="comments"><a href="/posts/make-gruntfile-js-10-rows/#comments"><span class="icon-bubbles"></span>Comments</a></div><div class="pagination group"></div></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js" type="text/javascript"></script><script src="/scripts/main.js" type="text/javascript"></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-35821550-3', 'watilde.github.io');
ga('send', 'pageview');</script></body></html>